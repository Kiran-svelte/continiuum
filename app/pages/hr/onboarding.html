<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR Onboarding Dashboard - Company.AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/css/animations.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Premium Cyber Theme Overrides */
        body {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f172a 100%);
            background-attachment: fixed;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(circle at 20% 30%, rgba(236, 72, 153, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.05) 0%, transparent 50%);
            animation: gradientShift 15s ease infinite;
            z-index: 0;
        }

        .main-wrapper {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* Sidebar styles reused from style.css but defined here for specificity if needed */
        .premium-sidebar {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(236, 72, 153, 0.2);
            padding: 32px 24px;
            position: relative;
            overflow: hidden;
        }

        .premium-sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(236, 72, 153, 0.05) 0%, transparent 100%);
            z-index: 0;
        }

        .premium-sidebar>* {
            position: relative;
            z-index: 1;
        }

        .logo-section {
            margin-bottom: 48px;
            text-align: center;
        }

        .logo-text {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 50%, #3b82f6 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientShift 4s ease infinite;
        }

        .hr-badge {
            display: inline-block;
            padding: 6px 16px;
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(139, 92, 246, 0.2));
            border: 1px solid rgba(236, 72, 153, 0.3);
            border-radius: 50px;
            color: #ec4899;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            margin-top: 8px;
            letter-spacing: 0.5px;
        }

        .ai-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: #10b981;
            justify-content: center;
            margin-top: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 18px;
            margin-bottom: 8px;
            border-radius: 12px;
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .nav-item:hover {
            background: rgba(236, 72, 153, 0.1);
            color: #ec4899;
            transform: translateX(8px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.2), rgba(139, 92, 246, 0.2));
            color: white;
            border: 1px solid rgba(236, 72, 153, 0.3);
        }

        /* Main Content */
        .premium-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            opacity: 0;
            animation: fadeInDown 0.6s ease-out 0.2s forwards;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-title {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff 0%, rgba(255, 255, 255, 0.7) 100%);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Pipeline Cards */
        .pipeline-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .pipeline-card {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.6));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .pipeline-card:hover {
            transform: translateY(-5px);
            border-color: rgba(236, 72, 153, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .pipeline-card.active {
            border-color: #ec4899;
            background: linear-gradient(135deg, rgba(236, 72, 153, 0.1), rgba(139, 92, 246, 0.1));
        }

        .pipeline-icon {
            font-size: 2rem;
            margin-bottom: 12px;
        }

        .pipeline-count {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin: 4px 0;
        }

        .pipeline-phase {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .pipeline-status {
            font-size: 0.75rem;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 12px;
            display: inline-block;
            background: rgba(255, 255, 255, 0.05);
            color: rgba(255, 255, 255, 0.5);
        }

        .pipeline-status.warning {
            color: #f59e0b;
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .pipeline-status.success {
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        /* Alerts Section */
        .alerts-section {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.6));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .alerts-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .alerts-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }

        .alert-item.critical {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
        }

        .alert-item.warning {
            background: rgba(245, 158, 11, 0.1);
            border-left: 4px solid #f59e0b;
        }

        .alert-content {
            flex: 1;
        }

        .alert-name {
            font-weight: 600;
            color: white;
        }

        .alert-detail {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .alert-action {
            padding: 8px 16px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.2s;
        }

        .alert-action:hover {
            background: rgba(236, 72, 153, 0.2);
            border-color: #ec4899;
        }

        /* Table Section */
        .table-section {
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.8), rgba(30, 41, 59, 0.6));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 24px;
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .table-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
        }

        .filter-select {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            outline: none;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
        }

        th {
            color: rgba(255, 255, 255, 0.5);
            font-weight: 600;
            padding: 12px;
            text-transform: uppercase;
            font-size: 0.8rem;
            text-align: left;
        }

        td {
            background: rgba(255, 255, 255, 0.03);
            padding: 16px;
            color: white;
            vertical-align: middle;
        }

        tr td:first-child {
            border-top-left-radius: 12px;
            border-bottom-left-radius: 12px;
        }

        tr td:last-child {
            border-top-right-radius: 12px;
            border-bottom-right-radius: 12px;
        }

        .employee-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .employee-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
        }

        .employee-name {
            font-weight: 600;
        }

        .employee-role {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .phase-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .phase-badge.offer-pending {
            background: rgba(245, 158, 11, 0.2);
            color: #fbbf24;
        }

        .phase-badge.pre-start {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
        }

        .phase-badge.day-0 {
            background: rgba(139, 92, 246, 0.2);
            color: #a78bfa;
        }

        .phase-badge.week-1 {
            background: rgba(236, 72, 153, 0.2);
            color: #f472b6;
        }

        .phase-badge.month-1 {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }

        .phase-badge.complete {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
        }

        .progress-bar {
            width: 100px;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 4px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ec4899, #8b5cf6);
        }

        .progress-text {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.5);
        }

        .btn-primary {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(236, 72, 153, 0.4);
        }

        .btn-action {
            padding: 6px 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .btn-view {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .btn-message {
            background: rgba(16, 185, 129, 0.15);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        /* Modal Premium Overrides */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            /* Darker overlay */
            backdrop-filter: blur(12px);
            /* Stronger blur */
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95));
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            width: 90%;
            max-width: 850px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 40px 80px -12px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.05);
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .modal-overlay.active .modal {
            transform: scale(1);
            opacity: 1;
        }

        .modal-header {
            padding: 32px 32px 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            background: transparent;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .modal-title {
            color: white;
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(to right, #fff, #94a3b8);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border-color: rgba(239, 68, 68, 0.3);
        }

        .modal-body {
            padding: 32px;
            color: var(--text-secondary);
        }

        .modal-footer {
            padding: 24px 32px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
        }

        /* Enhanced Step Wizard */
        .step-indicator {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-bottom: 40px;
            padding: 0 10px;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 50px;
            right: 50px;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 0;
        }

        .step {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: rgba(255, 255, 255, 0.4);
            font-weight: 500;
            font-size: 0.85rem;
            transition: all 0.3s;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #1e293b;
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .step.active {
            color: white;
        }

        .step.active .step-number {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            border-color: transparent;
            color: white;
            box-shadow: 0 0 0 4px rgba(236, 72, 153, 0.2);
            transform: scale(1.1);
        }

        .step.completed .step-number {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }

        .step.completed {
            color: #10b981;
        }

        /* Premium Forms */
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .form-input,
        .form-select {
            width: 100%;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.2s;
        }

        .form-input:focus,
        .form-select:focus {
            background: rgba(255, 255, 255, 0.05);
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
            outline: none;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.3);
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s;
            cursor: pointer;
        }

        .checkbox-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #ec4899;
        }

        .btn-secondary {
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border-color: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body>
    <div class="main-wrapper">
        <!-- Premium Sidebar -->
        <aside class="premium-sidebar">
            <div class="logo-section">
                <div class="logo-text">Company.AI</div>
                <div class="hr-badge">HR Panel</div>
                <div class="ai-status">
                    <div class="status-dot"></div>
                    <span>Online ‚Ä¢ HR Core v2.1</span>
                </div>
            </div>

            <nav style="display: flex; flex-direction: column; gap: 8px;">
                <a href="dashboard.html" class="nav-item">
                    <i data-lucide="layout-dashboard"></i>
                    <span>Dashboard</span>
                </a>
                <a href="leave-requests.html" class="nav-item">
                    <i data-lucide="file-text"></i>
                    <span>Leave Requests</span>
                </a>
                <a href="employees.html" class="nav-item">
                    <i data-lucide="users"></i>
                    <span>Employees</span>
                </a>
                <a href="onboarding.html" class="nav-item active">
                    <i data-lucide="user-plus"></i>
                    <span>Onboarding</span>
                </a>
                <a href="../hr-payroll.html" class="nav-item">
                    <i data-lucide="wallet"></i>
                    <span>Payroll</span>
                </a>
                <a href="reports.html" class="nav-item">
                    <i data-lucide="bar-chart-3"></i>
                    <span>Reports</span>
                </a>
            </nav>

            <div
                style="margin-top: auto; padding-top: 32px; position: absolute; bottom: 32px; left: 24px; right: 24px;">
                <button id="logoutBtn" class="nav-item" onclick="logout()"
                    style="width: 100%; color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3); cursor: pointer; background: transparent;">
                    <i data-lucide="log-out"></i>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main style="padding: 40px;">
            <div class="premium-header">
                <div>
                    <h2 class="page-title">üìã Onboarding Pipeline</h2>
                    <p style="color: rgba(255,255,255,0.5); margin-top: 8px; font-size: 1rem;">Manage new hires and
                        automate onboarding workflows</p>
                </div>
                <div style="display: flex; gap: 1rem;">
                    <a href="employee-tracking.html" class="btn-primary"
                        style="background: linear-gradient(135deg, #10b981, #059669); text-decoration: none;">
                        <span>ü§ñ</span> AI Tracker
                    </a>
                    <button class="btn-primary" onclick="openNewHireModal()">
                        <span>‚ûï</span> Add New Hire
                    </button>
                </div>
            </div>

            <!-- Pipeline Cards -->
            <div class="pipeline-grid" id="pipelineGrid">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading pipeline...</p>
                </div>
            </div>

            <!-- Alerts Section -->
            <div class="alerts-section">
                <div class="alerts-header">
                    <h3 class="alerts-title">üö® Requires Attention</h3>
                </div>
                <div id="alertsList">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Checking for alerts...</p>
                    </div>
                </div>
            </div>

            <!-- Employee Table -->
            <div class="table-section">
                <div class="table-header">
                    <h3 class="table-title">All Onboarding Employees</h3>
                    <div class="table-filters">
                        <select class="filter-select" id="filterPhase" onchange="filterTable()">
                            <option value="">All Phases</option>
                            <option value="offer_pending">Offer Stage</option>
                            <option value="pre_start">Pre-Start</option>
                            <option value="day_0">Day 0</option>
                            <option value="week_1">Week 1</option>
                            <option value="month_1">Month 1</option>
                        </select>
                        <select class="filter-select" id="filterDept" onchange="filterTable()">
                            <option value="">All Departments</option>
                        </select>
                    </div>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Employee</th>
                            <th>Department</th>
                            <th>Start Date</th>
                            <th>Phase</th>
                            <th>Progress</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="employeeTableBody">
                        <tr>
                            <td colspan="6" class="loading">
                                <div class="spinner"></div>
                                <p>Loading employees...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Add New Hire Modal -->
    <div class="modal-overlay" id="newHireModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">‚ûï Add New Employee</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step active" id="step1">
                        <span class="step-number">1</span>
                        <span>Details</span>
                    </div>
                    <div class="step" id="step2">
                        <span class="step-number">2</span>
                        <span>Compliance</span>
                    </div>
                    <div class="step" id="step3">
                        <span class="step-number">3</span>
                        <span>Plan</span>
                    </div>
                    <div class="step" id="step4">
                        <span class="step-number">4</span>
                        <span>Activate</span>
                    </div>
                </div>

                <!-- Step 1: Personal Details -->
                <div id="formStep1">
                    <h4 style="margin-bottom: 1rem; color: #ec4899;">üë§ Personal Details</h4>
                    <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                        <div class="form-group">
                            <label class="form-label">Full Name *</label>
                            <input type="text" class="form-input" id="empName" placeholder="Enter full name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email *</label>
                            <input type="email" class="form-input" id="empEmail" placeholder="email@company.com"
                                required>
                        </div>
                    </div>
                    <div class="form-row"
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
                        <div class="form-group">
                            <label class="form-label">Role *</label>
                            <input type="text" class="form-input" id="empRole" placeholder="e.g., Senior Engineer">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Department *</label>
                            <select class="form-select" id="empDepartment">
                                <option value="">Select Department</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Sales">Sales</option>
                                <option value="Marketing">Marketing</option>
                                <option value="HR">HR</option>
                                <option value="Finance">Finance</option>
                                <option value="Design">Design</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row"
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
                        <div class="form-group">
                            <label class="form-label">Location *</label>
                            <select class="form-select" id="empLocation">
                                <option value="">Select Location</option>
                                <option value="US">United States</option>
                                <option value="IN">India</option>
                                <option value="UK">United Kingdom</option>
                                <option value="DE">Germany</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Start Date *</label>
                            <input type="date" class="form-input" id="empStartDate">
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label">Manager *</label>
                        <select class="form-select" id="empManager">
                            <option value="">Select Manager</option>
                        </select>
                    </div>

                    <h4 style="margin: 1.5rem 0 1rem; color: #8b5cf6;">‚öôÔ∏è Automation Preferences</h4>
                    <div class="checkbox-group" style="display: flex; flex-direction: column; gap: 12px;">
                        <label class="checkbox-item"
                            style="display: flex; gap: 12px; padding: 12px; border-radius: 8px; align-items: center;">
                            <input type="checkbox" id="autoEquipment" checked>
                            <span>Auto-order equipment</span>
                        </label>
                        <label class="checkbox-item"
                            style="display: flex; gap: 12px; padding: 12px; border-radius: 8px; align-items: center;">
                            <input type="checkbox" id="autoAccess" checked>
                            <span>Auto-provision system access</span>
                        </label>
                        <label class="checkbox-item"
                            style="display: flex; gap: 12px; padding: 12px; border-radius: 8px; align-items: center;">
                            <input type="checkbox" id="autoMeetings" checked>
                            <span>Schedule welcome meetings</span>
                        </label>
                        <label class="checkbox-item"
                            style="display: flex; gap: 12px; padding: 12px; border-radius: 8px; align-items: center;">
                            <input type="checkbox" id="manualApproval">
                            <span>Require manual approval for all steps</span>
                        </label>
                    </div>
                </div>

                <!-- Step 2: Compliance Check -->
                <div id="formStep2" style="display: none;">
                    <div id="complianceLoading" class="loading">
                        <div class="spinner"></div>
                        <p>‚è≥ AI Checking Compliance...</p>
                        <p style="font-size: 0.875rem; color: rgba(255,255,255,0.6);">Validating work authorization,
                            budget, equipment...</p>
                    </div>
                    <div id="complianceResult" style="display: none;"></div>
                </div>

                <!-- Step 3: Generated Plan -->
                <div id="formStep3" style="display: none;">
                    <div id="planContent"></div>
                </div>

                <!-- Step 4: AI Activation -->
                <div id="formStep4" style="display: none;">
                    <div id="activationContent"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="btnBack" onclick="prevStep()" style="display: none;">‚Üê Back</button>
                <button class="btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn-primary" id="btnNext" onclick="nextStep()">Next: Compliance Check ‚Üí</button>
            </div>
        </div>
    </div>

    <script src="../../assets/js/api.js"></script>
    <script>
        // --- LOGIC PRESERVED FROM ORIGINAL FILE ---
        let currentStep = 1;
        let complianceData = null;
        let onboardingPlan = null;
        let allOnboardings = [];

        const token = localStorage.getItem('token');
        if (!token) {
            // alert('Please login first');
            // window.location.href = '../../index.html';
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const user = JSON.parse(localStorage.getItem('user') || '{}');

            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            const nextWeek = new Date();
            nextWeek.setDate(nextWeek.getDate() + 7);
            const startDateEl = document.getElementById('empStartDate');
            if (startDateEl) {
                startDateEl.valueAsDate = nextWeek;
            }

            await loadDashboard();
            await loadManagers();
        });

        async function loadDashboard() {
            try {
                const statsResponse = await API.get('/onboarding/stats');
                renderPipeline(statsResponse.stats || {});

                const allResponse = await API.get('/onboarding/all');
                allOnboardings = allResponse.onboardings || [];
                renderEmployeeTable(allOnboardings);

                renderAlerts(allOnboardings);
                loadDepartments(allOnboardings);
            } catch (error) {
                console.error('Error loading dashboard:', error);
                document.getElementById('pipelineGrid').innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><p>No onboarding data yet. Add your first hire!</p></div>';
                document.getElementById('alertsList').innerHTML = '<div class="no-alerts">‚úÖ No alerts - all clear!</div>';
                document.getElementById('employeeTableBody').innerHTML = '<tr><td colspan="6" class="empty-state">No employees onboarding yet</td></tr>';
            }
        }

        function renderPipeline(stats) {
            const phases = [
                { key: 'offer_pending', icon: 'üìß', label: 'Offer Stage', statusKey: 'pending_signatures' },
                { key: 'pre_start', icon: 'üìÖ', label: 'Pre-Start', statusKey: 'on_track' },
                { key: 'day_0', icon: 'üéØ', label: 'Day 0 Today', statusKey: 'starting_today' },
                { key: 'week_1', icon: 'üìà', label: 'Week 1', statusKey: 'avg_completion' },
                { key: 'month_1', icon: 'üèÅ', label: 'Month 1', statusKey: 'goals_set' }
            ];

            let html = '';
            phases.forEach(phase => {
                const count = stats[phase.key] || 0;
                const statusText = getStatusText(phase, stats);
                html += `
                    <div class="pipeline-card" onclick="filterByPhase('${phase.key}')">
                        <div class="pipeline-icon">${phase.icon}</div>
                        <div class="pipeline-count">${count}</div>
                        <div class="pipeline-phase">${phase.label}</div>
                        <div class="pipeline-status ${statusText.class}">${statusText.text}</div>
                    </div>
                `;
            });

            document.getElementById('pipelineGrid').innerHTML = html || '<div class="empty-state"><p>Pipeline empty</p></div>';
        }

        function getStatusText(phase, stats) {
            const count = stats[phase.key] || 0;
            if (count === 0) return { text: 'No employees', class: '' };

            switch (phase.key) {
                case 'offer_pending': return { text: 'üîÑ Pending signatures', class: 'warning' };
                case 'pre_start': return { text: '‚úÖ All on track', class: 'success' };
                case 'day_0': return { text: '‚è∞ Starts today', class: 'warning' };
                case 'week_1': return { text: 'üìä In progress', class: '' };
                case 'month_1': return { text: 'üéØ Goals phase', class: '' };
                default: return { text: '', class: '' };
            }
        }

        function renderAlerts(onboardings) {
            const alerts = [];
            const today = new Date();

            onboardings.forEach(emp => {
                const startDate = new Date(emp.start_date);
                const daysDiff = Math.ceil((startDate - today) / (1000 * 60 * 60 * 24));
                const progress = emp.progress_percentage || 0;
                const phase = emp.current_phase || emp.phase || 'offer_pending';

                if (phase === 'pre_start' && daysDiff <= 1 && progress < 50) {
                    alerts.push({ type: 'critical', name: emp.employee_name, detail: `Starting ${daysDiff <= 0 ? 'today' : 'tomorrow'} but only ${progress}% ready`, action: 'View', onboardingId: emp.onboarding_id });
                }

                if (phase === 'day_0' && progress < 80) {
                    alerts.push({ type: 'warning', name: emp.employee_name, detail: `Day 0 today - ${100 - progress}% tasks incomplete`, action: 'Resolve', onboardingId: emp.onboarding_id });
                }
            });

            if (alerts.length === 0) {
                document.getElementById('alertsList').innerHTML = '<div class="no-alerts" style="color: rgba(255,255,255,0.7);">‚úÖ No alerts - all employees on track!</div>';
                return;
            }

            let html = '';
            alerts.forEach(alert => {
                html += `
                    <div class="alert-item ${alert.type}">
                        <div class="alert-icon" style="font-size: 1.2rem;">${alert.type === 'critical' ? 'üî¥' : '‚ö†Ô∏è'}</div>
                        <div class="alert-content">
                            <div class="alert-name">${alert.name}</div>
                            <div class="alert-detail">${alert.detail}</div>
                        </div>
                        <button class="alert-action" onclick="viewEmployee('${alert.onboardingId}')">${alert.action}</button>
                    </div>
                `;
            });

            document.getElementById('alertsList').innerHTML = html;
        }

        function renderEmployeeTable(onboardings) {
            if (!onboardings || onboardings.length === 0) {
                document.getElementById('employeeTableBody').innerHTML = '<tr><td colspan="6" class="empty-state">No employees onboarding. Click "Add New Hire" to start!</td></tr>';
                return;
            }

            let html = '';
            onboardings.forEach(emp => {
                const initials = (emp.employee_name || 'NA').split(' ').map(n => n[0]).join('').substring(0, 2);
                const progress = emp.progress_percentage || 0;
                const phase = emp.current_phase || emp.phase || 'offer_pending';
                const phaseClass = phase.replace('_', '-');

                html += `
                    <tr>
                        <td>
                            <div class="employee-info">
                                <div class="employee-avatar">${initials}</div>
                                <div>
                                    <div class="employee-name">${emp.employee_name || 'Unknown'}</div>
                                    <div class="employee-role">${emp.role || 'N/A'}</div>
                                </div>
                            </div>
                        </td>
                        <td>${emp.department || 'N/A'}</td>
                        <td>${formatDate(emp.start_date)}</td>
                        <td><span class="phase-badge ${phaseClass}">${formatPhase(phase)}</span></td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="progress-text">${progress}% complete</div>
                        </td>
                        <td>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn-action btn-view" onclick="viewEmployee('${emp.onboarding_id}')">View</button>
                                <button class="btn-action btn-message" onclick="messageEmployee('${emp.emp_id}')">Message</button>
                            </div>
                        </td>
                    </tr>
                `;
            });

            document.getElementById('employeeTableBody').innerHTML = html;
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function formatPhase(phase) {
            const labels = {
                'offer_pending': 'üìß Offer',
                'pre_start': 'üìÖ Pre-Start',
                'day_0': 'üéØ Day 0',
                'week_1': 'üìà Week 1',
                'month_1': 'üèÅ Month 1',
                'complete': '‚úÖ Complete'
            };
            return labels[phase] || phase;
        }

        function loadDepartments(onboardings) {
            const depts = [...new Set(onboardings.map(e => e.department).filter(Boolean))];
            const select = document.getElementById('filterDept');
            // Reset options first
            select.innerHTML = '<option value="">All Departments</option>';
            depts.forEach(dept => {
                select.innerHTML += `<option value="${dept}">${dept}</option>`;
            });
        }

        async function loadManagers() {
            try {
                const response = await API.get('/employees/managers');
                const managers = response.managers || [];
                const select = document.getElementById('empManager');
                managers.forEach(mgr => {
                    select.innerHTML += `<option value="${mgr.emp_id}">${mgr.full_name} (${mgr.department})</option>`;
                });
            } catch (error) {
                document.getElementById('empManager').innerHTML += `
                    <option value="EMP001">Rajesh Kumar (Engineering)</option>
                    <option value="EMP003">Arun Mehta (Engineering)</option>
                    <option value="EMP004">Sneha Patel (HR)</option>
                `;
            }
        }

        function filterByPhase(phase) {
            document.getElementById('filterPhase').value = phase;
            filterTable();
        }

        function filterTable() {
            const phaseFilter = document.getElementById('filterPhase').value;
            const deptFilter = document.getElementById('filterDept').value;
            let filtered = allOnboardings;
            if (phaseFilter) filtered = filtered.filter(e => e.phase === phaseFilter || e.current_phase === phaseFilter);
            if (deptFilter) filtered = filtered.filter(e => e.department === deptFilter);
            renderEmployeeTable(filtered);
        }

        // Modal Logic
        function openNewHireModal() {
            currentStep = 1;
            complianceData = null;
            onboardingPlan = null;
            updateStepUI();
            document.getElementById('newHireModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('newHireModal').classList.remove('active');
            document.querySelectorAll('.form-input, .form-select').forEach(el => {
                if (el.type !== 'date') el.value = '';
            });
            currentStep = 1;
            updateStepUI();
        }

        function updateStepUI() {
            for (let i = 1; i <= 4; i++) {
                const stepEl = document.getElementById(`step${i}`);
                stepEl.classList.remove('active', 'completed');
                if (i < currentStep) stepEl.classList.add('completed');
                if (i === currentStep) stepEl.classList.add('active');
            }

            document.getElementById('formStep1').style.display = currentStep === 1 ? 'block' : 'none';
            document.getElementById('formStep2').style.display = currentStep === 2 ? 'block' : 'none';
            document.getElementById('formStep3').style.display = currentStep === 3 ? 'block' : 'none';
            document.getElementById('formStep4').style.display = currentStep === 4 ? 'block' : 'none';

            document.getElementById('btnBack').style.display = currentStep > 1 ? 'inline-block' : 'none';

            const btnNext = document.getElementById('btnNext');
            switch (currentStep) {
                case 1: btnNext.textContent = 'Next: Compliance Check ‚Üí'; break;
                case 2: btnNext.textContent = 'Create Onboarding Plan ‚Üí'; break;
                case 3: btnNext.textContent = 'Start AI ‚Üí'; break;
                case 4: btnNext.textContent = 'Close'; break;
            }
        }

        async function nextStep() {
            if (currentStep === 1) {
                if (!document.getElementById('empName').value || !document.getElementById('empEmail').value) {
                    alert('Please fill in required fields'); return;
                }
                currentStep = 2; updateStepUI(); await runComplianceCheck();
            } else if (currentStep === 2) {
                currentStep = 3; updateStepUI(); await generateOnboardingPlan();
            } else if (currentStep === 3) {
                currentStep = 4; updateStepUI(); await activateAI();
            } else if (currentStep === 4) {
                closeModal(); await loadDashboard();
            }
        }

        function prevStep() {
            if (currentStep > 1) { currentStep--; updateStepUI(); }
        }

        async function runComplianceCheck() {
            document.getElementById('complianceLoading').style.display = 'block';
            document.getElementById('complianceResult').style.display = 'none';
            // Simulate compliance check delay and success
            setTimeout(() => {
                document.getElementById('complianceLoading').style.display = 'none';
                document.getElementById('complianceResult').style.display = 'block';
                document.getElementById('complianceResult').innerHTML = `
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); padding: 16px; border-radius: 12px; color: white;">
                        <h4 style="color: #34d399; margin-bottom: 8px;">‚úÖ Compliance Check Passed</h4>
                        <p style="font-size: 0.9rem; margin-bottom: 4px;">Score: 100% | No Constraints Violated</p>
                        <ul style="font-size: 0.85rem; color: rgba(255,255,255,0.7); padding-left: 20px;">
                            <li>Work Authorization: Verified</li>
                            <li>Budget: Approved</li>
                            <li>Equipment Stock: Available</li>
                        </ul>
                    </div>
                `;
            }, 1000);
        }

        async function generateOnboardingPlan() {
            document.getElementById('planContent').innerHTML = `
                <div style="text-align: center; padding: 2rem;">
                    <div class="spinner"></div>
                    <p>ü§ñ AI Engine generating personalized onboarding plan...</p>
                </div>
            `;

            try {
                // Get REAL AI-generated actions for each phase
                const phases = ['pre_boarding', 'day_one', 'week_one', 'month_one', 'month_three', 'completed'];
                const phaseNames = {
                    'pre_boarding': 'üìÖ PRE-BOARDING (Before Start)',
                    'day_one': 'üéØ DAY 1 SCHEDULE',
                    'week_one': 'üìà WEEK 1 TASKS',
                    'month_one': 'üöÄ MONTH 1 GOALS',
                    'month_three': '‚≠ê MONTH 3 MILESTONES',
                    'completed': '‚úÖ COMPLETION CHECKLIST'
                };

                // Call AI engine to get actions for each phase
                const phaseActions = {};
                for (const phase of phases.slice(0, 4)) { // Get first 4 phases for plan
                    try {
                        const response = await fetch(`http://localhost:8002/get-actions`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                phase: phase,
                                context: {
                                    name: name,
                                    role: role,
                                    department: department,
                                    location: location,
                                    start_date: startDate
                                }
                            })
                        });
                        const data = await response.json();
                        phaseActions[phase] = data.actions || [];
                    } catch (err) {
                        console.log(`Could not get actions for ${phase}:`, err);
                        phaseActions[phase] = [];
                    }
                }

                // Also get country rules for compliance context
                let countryRules = {};
                try {
                    const countryResponse = await fetch(`http://localhost:8002/country-rules/${location}`);
                    countryRules = await countryResponse.json();
                } catch (err) {
                    console.log('Could not get country rules:', err);
                }

                // Build the plan HTML from REAL AI data
                let phasesHtml = '';
                for (const phase of ['pre_boarding', 'day_one', 'week_one', 'month_one']) {
                    const actions = phaseActions[phase] || [];
                    if (actions.length > 0) {
                        phasesHtml += `
                            <div style="background: white; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                                <strong>${phaseNames[phase]}</strong>
                                <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                                    ${actions.map(action => `<li>${action}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    }
                }

                // Add country-specific requirements section if available
                let countrySection = '';
                if (countryRules.required_documents?.length > 0) {
                    countrySection = `
                        <div style="background: #fef3c7; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                            <strong>üìã ${countryRules.name || location} COMPLIANCE REQUIREMENTS</strong>
                            <div style="margin-top: 0.5rem;">
                                <p><strong>Required Documents:</strong></p>
                                <ul style="padding-left: 1.5rem;">
                                    ${countryRules.required_documents.map(doc => `<li>${doc}</li>`).join('')}
                                </ul>
                                ${countryRules.tax_forms?.length ? `
                                    <p style="margin-top: 0.5rem;"><strong>Tax Forms:</strong></p>
                                    <ul style="padding-left: 1.5rem;">
                                        ${countryRules.tax_forms.map(form => `<li>${form}</li>`).join('')}
                                    </ul>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }

                // If no AI actions were returned, show a message
                if (!phasesHtml) {
                    phasesHtml = `
                        <div style="background: white; border-radius: 8px; padding: 1rem;">
                            <p>AI engine is configuring personalized tasks for this role and department...</p>
                            <p>Tasks will be generated based on: <strong>${department} + ${role} + ${location}</strong></p>
                        </div>
                    `;
                }

                document.getElementById('planContent').innerHTML = `
                    <div style="background: #f0f4ff; border-radius: 12px; padding: 1.5rem; border: 1px solid #c7d2fe;">
                        <h4 style="margin-bottom: 0.5rem;">üéØ AI-GENERATED ONBOARDING PLAN: ${name}</h4>
                        <p style="color: #666; margin-bottom: 0.5rem;">${role}, ${department} - ${countryRules.name || location}</p>
                        <p style="margin-bottom: 1rem;"><strong>Start:</strong> ${formattedDate} | <strong>Engine:</strong> AI Constraint Engine v1.0</p>
                        
                        ${countrySection}
                        ${phasesHtml}
                        
                        <div style="background: #dcfce7; border-radius: 8px; padding: 0.75rem; margin-top: 1rem; font-size: 0.9rem;">
                            <strong>ü§ñ AI Tracking:</strong> This plan is dynamically generated based on role, department, and location. 
                            The AI will monitor progress and adjust tasks based on completion status.
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Error generating AI plan:', error);
                // Fallback to basic plan
                document.getElementById('planContent').innerHTML = `
                    <div style="background: #f0f4ff; border-radius: 12px; padding: 1.5rem; border: 1px solid #c7d2fe;">
                        <h4 style="margin-bottom: 0.5rem;">üéØ ONBOARDING PLAN: ${name}</h4>
                        <p style="color: #666; margin-bottom: 1.5rem;">${role}, ${location}</p>
                        <p style="margin-bottom: 1rem;"><strong>Start:</strong> ${formattedDate}</p>
                        <div style="background: #fef3c7; padding: 1rem; border-radius: 8px;">
                            <p>‚ö†Ô∏è AI Engine is currently unavailable. Using standard onboarding template.</p>
                            <p>Please ensure the AI services are running on port 8002.</p>
                        </div>
                    </div>
                `;
            }
        }

        async function activateAI() {
            document.getElementById('activationContent').innerHTML = `
                <div style="text-align: center; padding: 20px; color: white;">
                    <div style="font-size: 3rem; margin-bottom: 16px;">ü§ñ</div>
                    <h4>AI Agent Activated</h4>
                    <p style="color: rgba(255,255,255,0.6); margin-bottom: 24px;">Creating accounts, assigning training, and notifying stakeholders...</p>
                    <div style="background: rgba(16, 185, 129, 0.1); color: #34d399; padding: 12px; border-radius: 8px;">
                        ‚úÖ Employee Record Created Successfully
                    </div>
                </div>
             `;
        }

        function viewEmployee(id) { window.location.href = `employee-tracking.html?id=${id}`; }
        function messageEmployee(id) { alert('Message feature coming soon'); }
        function logout() { localStorage.clear(); window.location.href = '../../index.html'; }
    </script>
</body>

</html>